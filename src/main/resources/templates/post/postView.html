<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title th:text="'ìƒí’ˆ ìƒì„¸ë³´ê¸° - ' + ${post.title}">ìƒí’ˆ ìƒì„¸ë³´ê¸° - ì˜¤ëŠ˜ë“í…œ</title>
<style>
/* ===== ê³µí†µ ì„¤ì • ===== */
* { box-sizing: border-box; }
body {
    font-family: 'Pretendard', sans-serif;
    background: #fafafa;
    margin: 0;
}
/* ===== ì»¨í…Œì´ë„ˆ ===== */
.container { max-width: 1200px; margin: 0 auto; padding: 7.5rem 20px 2rem; }
/* ===== ë’¤ë¡œê°€ê¸° ===== */
.back-btn {
    display: inline-flex; align-items: center; gap: 0.5rem;
    color: #3a5a40; text-decoration: none; font-weight: 600;
    margin-bottom: 1.5rem; transition: opacity 0.3s;
    border: none; background: none; cursor: pointer; 
    padding: 0; font: inherit;
}
.back-btn:hover { opacity: 0.7; }
/* ===== ë©”ì¸ ì»¨í…ì¸  ===== */
.detail-wrapper {
    position: relative;
    display: flex; gap: 2rem; background: white;
    border-radius: 12px; padding: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
/* ===== ì´ë¯¸ì§€ ì„¹ì…˜ ===== */
.image-section { flex: 1; display: flex; flex-direction: column; gap: 1rem; }
.main-image {
    width: 100%; height: 500px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    background: #e4f7dd; color: white; font-size: 5rem;
}
.main-image img {
    width: 100%; height: 100%; object-fit: cover; border-radius: 12px;
}
.thumbnail-list { 
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; 
    margin-top: 1rem;
}
.thumbnail-item {
    width: 100%; height: 100px; border-radius: 8px; cursor: pointer;
    overflow: hidden; border: 2px solid #e0e0e0; transition: all 0.3s;
}
.thumbnail-item:hover { 
    border-color: #3a5a40; 
    transform: scale(1.05);
}
.thumbnail-item img {
    width: 100%; height: 100%; object-fit: cover;
}
/* ===== ì •ë³´ ì„¹ì…˜ ===== */
.info-section { flex: 1; display: flex; flex-direction: column; gap: 1.2rem; }
.post-status-badge {
    display: inline-block; padding: 6px 16px; border-radius: 20px;
    font-size: 0.9rem; font-weight: bold; width: fit-content;
}
.post-status-badge.sold {
    background: #f5f5f5;
    color: #999;
    font-size: 1.1rem;
    padding: 12px 24px;
}
.detail-wrapper.sold {
    background: #f5f5f5;
}

.detail-wrapper.sold .main-image {
    position: relative;
    filter: grayscale(30%);
}

.detail-wrapper.sold .main-image::after {
    content: 'ê±°ë˜ì™„ë£Œ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 1.5rem 3rem;
    border-radius: 12px;
    font-size: 2rem;
    font-weight: bold;
    z-index: 10;
}

.detail-wrapper.sold .post-title-detail,
.detail-wrapper.sold .post-price-detail {
    color: #999;
}
.post-title-detail { font-size: 2rem; font-weight: bold; color: #333; line-height: 1.3; }
.post-price-detail {
    font-size: 2.5rem; font-weight: bold; color: #3a5a40;
    border-bottom: 2px solid #f0f0f0; padding-bottom: 1rem;
}
.info-table { display: grid; gap: 1rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 1.5rem; }
.info-row { display: grid; grid-template-columns: 120px 1fr; gap: 1rem; }
.info-label { font-weight: 600; color: #666; }
.info-value { color: #333; }
/* ===== íŒë§¤ì ì •ë³´ ===== */
.seller-section {
    background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 0.5rem;
}
.seller-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #333; }
.seller-info { display: flex; align-items: center; gap: 1rem; }
.seller-avatar {
    width: 60px; height: 60px; border-radius: 50%;
    background: #e4f7dd; display: flex; align-items: center; justify-content: center;
    color: white; font-size: 1.8rem;
}
.seller-details { flex: 1; }
.seller-name { font-weight: 600; font-size: 1.1rem; margin-bottom: 0.3rem; }
.seller-rating { color: #666; font-size: 0.9rem; }
.seller-rating-stars {
    display: inline-block;
    position: relative;
    font-size: 0.9rem;
    margin-left: 0.3rem;
}
.seller-stars-container {
    position: relative;
    display: inline-block;
    line-height: 1;
}
.seller-stars-empty {
    color: #ddd;
    position: relative;
    z-index: 1;
}
.seller-stars-filled {
    position: absolute;
    top: 0;
    left: 0;
    color: #FFD700;
    overflow: hidden;
    white-space: nowrap;
    z-index: 2;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
}
/* ===== ì•¡ì…˜ ë²„íŠ¼ ===== */
.action-buttons {
    display: grid; grid-template-columns: 1fr 1fr 3fr;
    gap: 0.8rem; margin-top: 1rem;
}
.btn {
    padding: 15px; border: none; border-radius: 8px; font-size: 1rem;
    font-weight: 600; cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 0.5rem;
}
.btn-like, .btn-share { background: white; border: 2px solid #e0e0e0; color: #333; }
.btn-like:hover { border-color: #ff6b6b; color: #ff6b6b; }
.btn-like.liked { 
    background: #ffebee; 
    border-color: #ff6b6b; 
    color: #ff6b6b; 
}
.btn-share:hover { border-color: #3a5a40; color: #3a5a40; }
.btn-contact {
    background: #3a5a40; color: white; font-size: 1.1rem;
}
.btn-contact:hover {
    transform: translateY(-2px); box-shadow: 0 5px 15px rgba(58,90,64,0.3);
}
/* ===== ê¸€ ê´€ë¦¬ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨ ë°°ì¹˜) ===== */
.post-manage-buttons {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 10px;
  z-index: 10;
}

.btn-modify, .btn-delete {
  padding: 10px 20px;
  border-radius: 50px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.25s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* âœï¸ ìˆ˜ì • ë²„íŠ¼ â€” ë¶€ë“œëŸ¬ìš´ ê·¸ë¦°í†¤ */
.btn-modify {
  background: #e6f3eb;
  color: #3a5a40;
  border: 1px solid #cfe6d3;
}
.btn-modify:hover {
  background: #d3ecdd;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(58,90,64,0.15);
}

/* ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ â€” ì—°í•œ í•‘í¬í†¤ */
.btn-delete {
  background: #fdecea;
  color: #e74c3c;
  border: 1px solid #f5c6c3;
}
.btn-delete:hover {
  background: #fbd8d3;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(231,76,60,0.15);
}

/* í´ë¦­ ì‹œ ëˆŒë¦¼ íš¨ê³¼ */
.btn-modify:active, .btn-delete:active {
  transform: translateY(0);
}

/* ===== í•˜ë‹¨ ===== */
.detail-bottom {
    background: white; border-radius: 12px; padding: 2rem;
    margin-top: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.post-meta-detail {
    display: flex; justify-content: flex-end; gap: 1.5rem; color: #999;
    font-size: 0.95rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;
    margin-bottom: 1.5rem;
}
.meta-item { display: flex; align-items: center; gap: 0.4rem; }
.post-content { line-height: 1.8; color: #333; font-size: 1.05rem; white-space: pre-wrap; }
/* ===== ê³µìœ  ëª¨ë‹¬ ===== */
.share-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.share-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  text-align: center;
  min-width: 280px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.share-content h3 { margin-top: 0; color: #3a5a40; }
.share-buttons button {
  margin: 0.5rem;
  padding: 10px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #3a5a40;
  color: white;
  font-weight: 600;
}
.close-btn {
  margin-top: 1rem;
  background: #999;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
/* ===== ë°˜ì‘í˜• ===== */
@media (max-width: 768px) {
    .detail-wrapper { flex-direction: column; }
    .action-buttons { grid-template-columns: 1fr; }
    .post-manage-buttons {
        top: 10px;
        right: 10px;
        gap: 6px;
    }
    .btn-modify, .btn-delete {
        padding: 8px 16px;
        font-size: 0.85rem;
    }
}
</style>
</head>
<body>
<div th:replace="~{layouts/header.html}"></div>

<div class="container">
    <!-- ===== ìƒí’ˆ ìƒì„¸ ìƒë‹¨ ===== -->
    <div class="detail-wrapper" th:classappend="${post.status == 'SOLD' ? 'sold' : ''}">
        <!-- ì¢Œì¸¡ ì´ë¯¸ì§€ -->
        <div class="image-section">
            <div class="main-image">
			    <!-- ë©”ì¸ ì´ë¯¸ì§€ -->
			    <img id="mainImage" 
			         th:if="${post.postImage != null and !post.postImage.isEmpty()}"
			         th:src="${#strings.contains(post.postImage, ',') ? #strings.substringBefore(post.postImage, ',') : post.postImage}" 
			         alt="ëŒ€í‘œì´ë¯¸ì§€">
			    <span th:if="${post.postImage == null or post.postImage.isEmpty()}">ğŸ“·</span>
			</div>
			
			<!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ ëª©ë¡ -->
			<div class="thumbnail-list" th:if="${post.postImage != null and !post.postImage.isEmpty()}">
			    <div class="thumbnail-item" 
			         th:each="imgPath, iterStat : ${#strings.arraySplit(post.postImage, ',')}"
			         th:data-image="${imgPath}"
			         onclick="changeMainImage(this.dataset.image)">
			        <img th:src="${imgPath}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
			    </div>
			</div>
        </div>

        <!-- ìš°ì¸¡ ì •ë³´ -->
        <div class="info-section">
            <div class="post-status-badge"
                 th:text="${post.status == 'SOLD'} ? 'íŒë§¤ì™„ë£Œ' : (${post.status == 'RESERVED'} ? 'ì˜ˆì•½ì¤‘' : 'íŒë§¤ì¤‘')"
                 th:style="${post.status == 'SOLD'} ? 'background:#999;' : (${post.status == 'RESERVED'} ? 'background:#ff9800;' : 'background:#d17a3a;')">
                íŒë§¤ì¤‘
            </div>

            <h1 class="post-title-detail" th:text="${post.title}">ìƒí’ˆëª…</h1>
            <div class="post-price-detail"
                 th:text="${#numbers.formatInteger(post.price, 0, 'COMMA') + 'ì›'}">0ì›</div>

            <div class="info-table">
                <div class="info-row">
                    <div class="info-label">ì¹´í…Œê³ ë¦¬</div>
                    <div class="info-value" th:text="${post.category}">ì¹´í…Œê³ ë¦¬ëª…</div>
                </div>
                <div class="info-row">
		            <div class="info-label">ê±°ë˜ì§€ì—­</div>
			        <div class="info-value" 
			            th:text="${post.location != null ? post.location : 'ì§€ì—­ì •ë³´ ì—†ìŒ'}">
			            ì§€ì—­ì •ë³´
			        </div>
			    </div>
                <div class="info-row">
                    <div class="info-label">ê±°ë˜ë°©ë²•</div>
                    <div class="info-value" 
                         th:text="${post.tradeMethod == 'DIRECT' ? 'ì§ê±°ë˜' : (post.tradeMethod == 'DELIVERY' ? 'íƒë°°ê±°ë˜' : 'ì§ê±°ë˜/íƒë°° ëª¨ë‘')}">
                        ì§ê±°ë˜
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">ìƒí’ˆìƒíƒœ</div>
                    <div class="info-value" 
                         th:text="${post.conditionStatus == 'NEW' ? 'ìƒˆìƒí’ˆ' : (post.conditionStatus == 'LIKE_NEW' ? 'ê±°ì˜ ìƒˆê²ƒ' : 'ì¤‘ê³ ')}">
                        ì¤‘ê³ 
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">ê°€ê²©í¥ì •</div>
                    <div class="info-value" 
                         th:text="${post.negotiable == 'Y' ? 'ê°€ëŠ¥' : 'ë¶ˆê°€ëŠ¥'}"
                         th:style="${post.negotiable == 'Y' ? 'color: #3a5a40; font-weight: bold;' : 'color: #999;'}">
                        ë¶ˆê°€ëŠ¥
                    </div>
                </div>
            </div>

            <div class="seller-section">
                <div class="seller-title">íŒë§¤ì ì •ë³´</div>
                <a id="sellerLink" href="#" onclick="goToSellerPage(); return false;" 
                   style="text-decoration: none; color: inherit; cursor: pointer;">
                    <div class="seller-info">
                        <div class="seller-avatar">
                            <img th:if="${seller != null and seller.profileImage != null and !seller.profileImage.isEmpty()}"
                                 th:src="${seller.profileImage}"
                                 alt="í”„ë¡œí•„" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                            <span th:if="${seller == null or seller.profileImage == null or seller.profileImage.isEmpty()}">ğŸ‘¤</span>
                        </div>
                        <div class="seller-details">
                            <div class="seller-name" 
                                 th:text="${seller != null ? seller.username + ' (' + seller.email + ')' : 'ì•Œ ìˆ˜ ì—†ìŒ'}">
                                íŒë§¤ì
                            </div>
                            <div class="seller-rating">
                                <!-- í‰ì  ìˆ«ì -->
                                <span th:text="${sellerRating != null ? sellerRating : 0.0}">0.0</span>
                                
                                <!-- ì •ë°€í•œ ë³„ì  í‘œì‹œ -->
                                <span class="seller-rating-stars">
                                    <span class="seller-stars-container">
                                        <span class="seller-stars-empty">â˜…â˜…â˜…â˜…â˜…</span>
                                        <span class="seller-stars-filled" 
                                              th:style="${sellerRating != null ? 'width: ' + (sellerRating * 20) + '%' : 'width: 0%'}">â˜…â˜…â˜…â˜…â˜…</span>
                                    </span>
                                </span>
                                
                                <!-- í‰ê°€ ì—†ìŒ í‘œì‹œ -->
                                <span th:if="${sellerRating == null || sellerRating == 0}" 
                                      style="margin-left: 0.5rem; color: #999;">(í‰ê°€ ì—†ìŒ)</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>

            <div class="action-buttons">
			    <button class="btn btn-like" 
			            th:data-post-id="${post.postId}"
			            th:data-wishlist-count="${post.wishlistCount}"
			            onclick="toggleLike(this)">
			        <span>â¤ï¸ ì°œ</span>
			        <span class="wishlist-count" th:text="${post.wishlistCount}">0</span>
			    </button>
			
			    <button class="btn btn-share" 
			            th:data-post-id="${post.postId}" 
			            onclick="sharePost(this)">ğŸ”— ê³µìœ </button>
			
			    <button class="btn btn-contact"
				        th:data-member-id="${post.userId}"
				        onclick="openChat(this)">
				    ğŸ’¬ íŒë§¤ìì™€ ì±„íŒ…í•˜ê¸°
				</button>
			</div>
			
		<!-- ë³¸ì¸ ê¸€ì¼ ë•Œë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ (ìš°ì¸¡ ìƒë‹¨) -->
		<div class="post-manage-buttons" th:if="${session.userId != null and session.userId == post.userId}">
		    <button class="btn-modify" 
		            th:if="${post.status != 'SOLD'}"
		            th:onclick="'location.href=\'/post/postModifyForm/' + ${post.postId} + '\''">
		        <span>âœï¸</span> ìˆ˜ì •
		    </button>
		    <button class="btn-delete" onclick="deletePost()">
		        <span>ğŸ—‘ï¸</span> ì‚­ì œ
		    </button>
		</div>
        </div>
    </div>

    <!-- ===== í•˜ë‹¨ (ë³¸ë¬¸) ===== -->
    <div class="detail-bottom">
        <div class="post-meta-detail">
            <div class="meta-item">ğŸ‘ ì¡°íšŒ <span th:text="${post.hit}">0</span></div>
            <div class="meta-item">â° <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">ë“±ë¡ì¼</span></div>
        </div>

        <div class="post-content" th:text="${post.content}">
            ìƒí’ˆ ì„¤ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>
</div>

<!-- ===== ê³µìœ  ëª¨ë‹¬ ===== -->
<div id="shareModal" class="share-modal">
  <div class="share-content">
    <h3>ìƒí’ˆ ê³µìœ í•˜ê¸°</h3>
    <p>ê³µìœ í•  ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš” ğŸ‘‡</p>
    <div class="share-buttons">
      <button onclick="copyLink()">ğŸ“‹ ë§í¬ ë³µì‚¬</button>
      <button onclick="shareKakao()">ğŸŸ¡ ì¹´ì¹´ì˜¤í†¡</button>
      <button onclick="shareTwitter()">ğŸ¦ íŠ¸ìœ„í„°</button>
    </div>
    <button class="close-btn" onclick="closeShareModal()">ë‹«ê¸° âœ–ï¸</button>
  </div>
</div>

<div th:replace="~{layouts/footer.html}"></div>

<script th:inline="javascript">
/*<![CDATA[*/
// ì´ë¯¸ì§€ ë³€ê²½ ê¸°ëŠ¥
function changeMainImage(imagePath) {
    const mainImage = document.getElementById('mainImage');
    mainImage.src = imagePath;
}

// ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬
const isLoggedIn = /*[[${session.userId != null}]]*/ false;
const currentUserId = /*[[${session.userId}]]*/ null;
const sellerId = /*[[${post.userId}]]*/ null;
const postId = /*[[${post.postId}]]*/ null;
const isSeller = isLoggedIn && (currentUserId === sellerId);

// âœ… ì°œí•˜ê¸° ê¸°ëŠ¥
function toggleLike(button) {
    // ë¡œê·¸ì¸ ì²´í¬
    if (!isLoggedIn) {
        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            // í˜„ì¬ í˜ì´ì§€ URLì„ ì €ì¥í•˜ê³  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            sessionStorage.setItem('redirectUrl', window.location.href);
            window.location.href = '/user/loginForm';
        }
        return;
    }
    
    // íŒë§¤ì ë³¸ì¸ ì²´í¬
    if (isSeller) {
        alert('ë³¸ì¸ì´ ë“±ë¡í•œ ìƒí’ˆì€ ì°œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    fetch(`/post/${postId}/like`, { method: "POST" })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            alert(data.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            return;
        }
        
        const wishlistCountSpan = button.querySelector('.wishlist-count');
        
        if (data.liked) {
            button.classList.add('liked');
            wishlistCountSpan.textContent = data.wishlistCount;
        } else {
            button.classList.remove('liked');
            wishlistCountSpan.textContent = data.wishlistCount;
        }
    })
    .catch(err => {
        console.error("ì°œ ì˜¤ë¥˜:", err);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// âœ… ê³µìœ  ê¸°ëŠ¥
function sharePost(button) {
    const postId = button.getAttribute("data-post-id");
    const postUrl = `${window.location.origin}/post/postView/${postId}`;

    if (navigator.share) {
        navigator.share({
            title: "ì˜¤ëŠ˜ë“í…œ ìƒí’ˆ ê³µìœ ",
            text: "ì´ ìƒí’ˆ ê´œì°®ì•„ìš”! ğŸ‘‡",
            url: postUrl
        }).catch(err => console.log("ê³µìœ  ì·¨ì†Œ:", err));
    } else {
        openShareModal(postUrl);
    }
}

// âœ… ì»¤ìŠ¤í…€ ê³µìœ  ëª¨ë‹¬
function openShareModal(url) {
    window.currentShareUrl = url;
    document.getElementById("shareModal").style.display = "flex";
}
function closeShareModal() {
    document.getElementById("shareModal").style.display = "none";
}
function copyLink() {
    navigator.clipboard.writeText(window.currentShareUrl)
        .then(() => alert("ğŸ“‹ ìƒí’ˆ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"))
        .catch(() => alert("âŒ ë³µì‚¬ ì‹¤íŒ¨"));
}
function shareKakao() {
    window.open(`https://sharer.kakao.com/talk/friends/picker/link?url=${encodeURIComponent(window.currentShareUrl)}`, '_blank');
}
function shareTwitter() {
    window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(window.currentShareUrl)}&text=ì˜¤ëŠ˜ë“í…œ ìƒí’ˆ!`, '_blank');
}

// âœ… ì±„íŒ… ì—´ê¸°
function openChat(button) {
    // ë¡œê·¸ì¸ ì²´í¬
    if (!isLoggedIn) {
        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            sessionStorage.setItem('redirectUrl', window.location.href);
            window.location.href = '/user/loginForm';
        }
        return;
    }
    
    // íŒë§¤ì ë³¸ì¸ì´ë©´ ì´ ìƒí’ˆì˜ ì±„íŒ… ëª©ë¡ìœ¼ë¡œ
    if (isSeller) {
        location.href = `/product/chatrooms?postId=${postId}`;
        return;
    }
    
    // êµ¬ë§¤ì: íŒë§¤ìì™€ ì±„íŒ… ì‹œì‘
    const sellerId = button.getAttribute("data-member-id");
    if (!sellerId) {
        alert("íŒë§¤ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    
    // postIdì™€ sellerIdë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
    location.href = `/product/chat?postId=${postId}&sellerId=${sellerId}`;
}

// íŒë§¤ì í˜ì´ì§€ë¡œ ì´ë™
function goToSellerPage() {
    // ë³¸ì¸ì´ë©´ myPageë¡œ, ë‹¤ë¥¸ ì‚¬ëŒì´ë©´ userInfoë¡œ
    if (isSeller) {
        location.href = '/user/myPage';
    } else {
        location.href = `/user/userInfo/${sellerId}`;
    }
}

// ê¸€ì‚­ì œ ê¸°ëŠ¥
function deletePost() {
    if (confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê¸€ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/post/postDelete/${postId}`;
        document.body.appendChild(form);
        form.submit();
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì²˜ë¦¬
document.addEventListener('DOMContentLoaded', function() {
    // íŒë§¤ì ë³¸ì¸ì´ë©´ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    if (isSeller) {
        const chatButton = document.querySelector('.btn-contact');
        if (chatButton) {
            chatButton.innerHTML = 'ğŸ’¬ ì±„íŒ… í™•ì¸í•˜ê¸°';
        }
    }
    
    // ì´ë¯¸ ì°œí•œ ìƒíƒœë©´ liked í´ë˜ìŠ¤ ì¶”ê°€
    const isLiked = /*[[${isLiked}]]*/ false;
    if (isLiked) {
        const likeButton = document.querySelector('.btn-like');
        if (likeButton) {
            likeButton.classList.add('liked');
        }
    }
    
    // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì— ì´ì „ í˜ì´ì§€ ì •ë³´ ì ìš©
    const urlParams = new URLSearchParams(window.location.search);
    const refPage = urlParams.get('pg');
    const refSort = urlParams.get('sort');
    const refTitle = urlParams.get('title');
    const refSido = urlParams.get('sido');
    const refSigungu = urlParams.get('sigungu');
    const refDong = urlParams.get('dong');
    const refCategory = urlParams.get('category');
    const refMinPrice = urlParams.get('minPrice');
    const refMaxPrice = urlParams.get('maxPrice');
    
    if (refPage || refSort || refTitle || refSido || refCategory || refMinPrice) {
        const backBtn = document.getElementById('backBtn');
        let backUrl = '/post/postList?';
        const params = [];
        
        if (refPage) params.push('pg=' + refPage);
        if (refSort) params.push('sort=' + refSort);
        if (refTitle) params.push('title=' + encodeURIComponent(refTitle));
        if (refSido) params.push('sido=' + encodeURIComponent(refSido));
        if (refSigungu) params.push('sigungu=' + encodeURIComponent(refSigungu));
        if (refDong) params.push('dong=' + encodeURIComponent(refDong));
        if (refCategory) params.push('category=' + encodeURIComponent(refCategory));
        if (refMinPrice) params.push('minPrice=' + refMinPrice);
        if (refMaxPrice) params.push('maxPrice=' + refMaxPrice);
        
        backBtn.href = backUrl + params.join('&');
    }
});
/*]]>*/
</script>

</body>
</html>