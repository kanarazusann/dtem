<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>íšŒì›ê°€ì… - ì˜¤ëŠ˜ë“í…œ</title>
<script type="text/javascript">


</script>
<style>
/* ===== ê³µí†µ: ë©”ì¸ í†¤ ===== */
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
		'Helvetica Neue', Arial, sans-serif;
	background: #f8f9fa;
	color: #333;
}

header {
	background: linear-gradient(135deg, #e4f7dd 0%, #2F9D27 100%);
	color: #fff;
	padding: 1rem 0;
	box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
}

.header-container {
	max-width: 1200px;
	margin: 0 auto;
	padding: 0 20px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.logo {
	font-size: 1.8rem;
	font-weight: 800;
	cursor: pointer;
}

.nav-menu {
	display: flex;
	gap: 2rem;
	list-style: none;
}

.nav-menu a {
	color: #fff;
	text-decoration: none;
	font-weight: 500;
	opacity: .95;
	transition: opacity .2s;
}

.nav-menu a:hover {
	opacity: .8;
}

/* ===== ë ˆì´ì•„ì›ƒ ===== */
.outer {
	max-width: 1200px;
	margin: 0 auto;
	padding: 40px 20px;
	/* ì¤‘ì•™ ì •ë ¬ ì¶”ê°€ */
	display: flex;
	justify-content: center;
	align-items: center;
	min-height: calc(100vh - 200px); /* í—¤ë”, í‘¸í„° ì œì™¸í•œ ë†’ì´ í™•ë³´ */
}

/* ===== ê°€ì… í¼ ì¹´ë“œ ===== */
.card {
	background: #fff;
	border-radius: 14px;
	padding: 26px;
	box-shadow: 0 8px 20px rgba(0, 0, 0, .06);
	border: 1px solid #eee;
	/* í¼ì„ í™”ë©´ ì¤‘ì•™ì— ê³ ì • ë°°ì¹˜ */
	width: 100%;
	max-width: 700px; /* ì¤‘ì•™ì— ë³´ê¸° ì¢‹ì€ í¼ í­ */
	margin: 0 auto;
}

.card h2 {
	font-size: 1.6rem;
	font-weight: 800;
	color: #3a5a40;
	margin-bottom: 8px;
	text-align: center;
}

.card .sub {
	text-align: center;
	color: #666;
	margin-bottom: 20px;
}

.form-row {
	display: flex;
	flex-direction: column;
	gap: 8px;
	margin-bottom: 14px;
}

label {
	font-weight: 700;
	color: #333;
}

input[type="text"], input[type="password"], input[type="email"], input[type="tel"], textarea
	{
	padding: 14px 16px;
	border: 2px solid #e6e6f4;
	border-radius: 10px;
	font-size: 1rem;
	background: #fff;
	transition: border-color .15s, box-shadow .15s;
}

textarea {
	resize: vertical;
	min-height: 100px;
	font-family: inherit;
}

input:focus, textarea:focus {
	outline: none;
	border-color: #3a5a40;
	box-shadow: 0 0 0 3px rgba(58, 90, 64, .15);
}

.row-inline {
	display: flex;
	gap: 8px;
}

.grid-2 {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 12px;
}

@media ( max-width : 560px) {
	.grid-2 {
		grid-template-columns: 1fr;
	}
}

.helper {
	font-size: .9rem;
	color: #777;
}

.error {
	display: none;
	color: #c0392b;
	font-size: .88rem;
	margin-top: -4px;
}

.pw-wrap {
	margin-top: 4px;
}

.pw-meter {
	width: 100%;
	height: 8px;
	background: #e4f7dd;
	border-radius: 6px;
	overflow: hidden;
	border: 1px solid #e4e6ff;
}

.pw-bar {
	height: 100%;
	width: 0%;
	background: linear-gradient(135deg, #ff9a9e, #fad0c4);
	transition: width .2s;
}

.btn-primary {
	width: 100%;
	padding: 14px 16px;
	border: none;
	border-radius: 10px;
	cursor: pointer;
	background: linear-gradient(135deg,#3a5a40 100%);
	color: #fff;
	font-weight: 800;
	font-size: 1rem;
	box-shadow: 0 8px 16px rgba(102, 126, 234, .25);
	transition: transform .12s;
}

.btn-primary:hover {
	transform: translateY(-2px);
}

.btn-ghost {
	width: 100%;
	padding: 12px 16px;
	border-radius: 10px;
	border: 2px solid #e6e6f4;
	background: #fff;
	color: #333;
	font-weight: 800;
}

.mini {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-top: 10px;
	font-size: .92rem;
}

.mini a {
	color: #3a5a40;
	text-decoration: none;
}

.mini a:hover {
	text-decoration: underline;
}

footer {
	background: #2c3e50;
	color: #fff;
	padding: 28px 0;
	text-align: center;
	margin-top: 34px;
}
</style>
</head>
<body>
	<!-- í—¤ë” -->
	<div th:replace="~{layouts/header.html}"></div>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>

	<!-- ë³¸ë¬¸ -->

	<!-- ìš°ì¸¡: ê°€ì… í¼ -->
	<section class="card">
		<h2>íšŒì›ê°€ì…</h2>
		<p class="sub">ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ë°”ë¡œ ì˜¤ëŠ˜ë“í…œì„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.</p>

		<!-- ê²½ë¡œëŠ” /user ë¡œ í†µì¼ -->
		<form action="/user/write" name="frm" method="post" enctype="multipart/form-data"
			onsubmit="return submitJoin();">
			
			<!-- í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ -->
			<div class="form-row" style="text-align: center; margin-bottom: 24px;">
				<label style="margin-bottom: 12px;">í”„ë¡œí•„ ì‚¬ì§„ (ì„ íƒ)</label>
				<div style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
					<div id="profilePreview" style="width: 120px; height: 120px; background: linear-gradient(135deg, #e4f7dd 0%, #e4f9dd 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 3.5rem; overflow: hidden; border: 3px solid #e6e6f4;">
						<span id="profileIcon">ğŸ‘¤</span>
						<img id="previewImage" style="display: none; width: 100%; height: 100%; object-fit: cover;" />
					</div>
					<input type="file" id="profileImage" name="profileImage" accept="image/*" style="display: none;" onchange="previewProfileImage(event)">
					<button type="button" class="btn-ghost" style="width: auto; padding: 10px 20px;" onclick="document.getElementById('profileImage').click()">ì‚¬ì§„ ì„ íƒ</button>
					<small class="helper">jpg, png íŒŒì¼ (ìµœëŒ€ 10MB)</small>
				</div>
			</div>
			
			<div class="form-row">
				<label for="email">ì´ë©”ì¼ (ë¡œê·¸ì¸ ID) <span style="color: red;">*</span></label>
				<div class="row-inline">
					<input type="email" id="email" name="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
						required>
					<button type="button" class="btn-ghost" id="sendCodeBtn"
						style="width: auto; padding: 12px 14px" onclick="sendVerificationCode()">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button>
				</div>
				<small class="helper">ì˜ˆ: user@example.com</small>
				<div id="emailError" class="error">ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.</div>
				<div id="emailSuccess" class="error" style="color: #28a745; display: none;">âœ“ ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
			</div>
			
			<div class="form-row" id="verificationRow" style="display: none;">
				<label for="verificationCode">ì¸ì¦ë²ˆí˜¸ ì…ë ¥ <span style="color: red;">*</span></label>
				<div class="row-inline">
					<input type="text" id="verificationCode" placeholder="6ìë¦¬ ì¸ì¦ë²ˆí˜¸"
						maxlength="6" pattern="[0-9]{6}">
					<button type="button" class="btn-ghost"
						style="width: auto; padding: 12px 14px" onclick="verifyCode()">ì¸ì¦ í™•ì¸</button>
				</div>
				<small class="helper" id="timerText">ìœ íš¨ì‹œê°„: <span style="color: #e74c3c; font-weight: 600;">5:00</span></small>
				<div id="verifyError" class="error">ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
				<div id="verifySuccess" class="error" style="color: #28a745; display: none;">âœ“ ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
			</div>

			<div class="grid-2">
				<div class="form-row">
					<label for="pwd">ë¹„ë°€ë²ˆí˜¸</label>
					<div class="row-inline">
						<input type="password" id="pwd" name="pwd"
							placeholder="ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì 8~20ì" minlength="8" maxlength="20"
							required oninput="updatePwMeter()">
						<button type="button" class="btn-ghost" style="width: auto"
							onclick="togglePwd('pwd', this)">ë³´ê¸°</button>
					</div>
					<div class="pw-wrap">
						<div class="pw-meter">
							<div id="pwBar" class="pw-bar"></div>
						</div>
						<small id="pwTip" class="helper">ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</small>
					</div>
					<div id="pwdError" class="error">ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.</div>
				</div>
				<div class="form-row">
					<label for="pwd2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
					<div class="row-inline">
						<input type="password" id="pwd2" name="pwd2" placeholder="í•œë²ˆ ë” ì…ë ¥"
							minlength="8" maxlength="20" required>
						<button type="button" class="btn-ghost" style="width: auto"
							onclick="togglePwd('pwd2', this)">ë³´ê¸°</button>
					</div>
					<div id="pwd2Error" class="error">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
				</div>
			</div>

			<div class="grid-2">
				<div class="form-row">
					<label for="name">ì´ë¦„</label> <input type="text" id="name"
						name="name" placeholder="ì´ë¦„" required>
				</div>
				<div class="form-row">
					<label for="tel">íœ´ëŒ€í°</label> 
					<input type="tel" id="tel" name="tel"
						placeholder="01012345678 (ìˆ«ìë§Œ ì…ë ¥)"
						pattern="^01[0-9]{8,9}$" maxlength="11" onblur="checkPhoneDuplicate()">
					<div id="phoneError" class="error">ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.</div>
					<div id="phoneSuccess" class="error" style="color: #28a745; display: none;">âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.</div>
				</div>
			</div>

			<div class="form-row">
				<label for="postcode">ì£¼ì†Œ</label>
				<div>
					<input type="text" id="postcode" name="zipcode" placeholder="ìš°í¸ë²ˆí˜¸"
						readonly style="max-width: 160px">
					<button type="button" class="btn-ghost" style="width: auto;"
						onclick="execPostcode()">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button>
				</div>
				<small class="helper">'ìš°í¸ë²ˆí˜¸ ì°¾ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ ì£¼ì„¸ìš”.</small>
			</div>

			<div class="form-row">
				<input type="text" id="roadAddress" name="addrRoad"
					placeholder="ë„ë¡œëª… ì£¼ì†Œ" readonly>
			</div>
			<div class="form-row">
				<input type="text" id="jibunAddress" name="addrJibun"
					placeholder="ì§€ë²ˆ ì£¼ì†Œ" readonly>
			</div>
			<div class="form-row">
				<input type="text" id="extraAddress" name="addrExtra"
					placeholder="ì°¸ê³  í•­ëª©(ë™/ê±´ë¬¼ëª… ë“±)" readonly>
			</div>
			<div class="form-row">
				<input type="text" id="detailAddress" name="addrDetail"
					placeholder="ìƒì„¸ ì£¼ì†Œ(ë™/í˜¸ìˆ˜ ë“±)" required>
			</div>

			<div class="form-row">
				<label for="introduce">ìê¸°ì†Œê°œ (ì„ íƒ)</label>
				<textarea id="introduce" name="introduce" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)"></textarea>
			</div>

			<div style="margin-top: 12px"></div>
			<button type="submit" class="btn-primary">íšŒì›ê°€ì…</button>
			<div class="mini">
				<a href="/user/loginForm">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a> <a href="/index">ë©”ì¸ìœ¼ë¡œ</a>
			</div>
		</form>
	</section>
	</div>
	</div>

	<div th:replace="~{layouts/footer.html}"></div>


	<script
		src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		// ì „ì—­ ë³€ìˆ˜
		let timerInterval = null;
		let isEmailVerified = false;
		let isPhoneAvailable = true;  // ì „í™”ë²ˆí˜¸ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€
		
		// ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ë°œì†¡
		function sendVerificationCode() {
			const email = document.getElementById('email').value.trim();
			
			if(!email) {
				alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
				return;
			}
			
			// ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if(!emailRegex.test(email)) {
				alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
				return;
			}
			
			// ë²„íŠ¼ ë¹„í™œì„±í™”
			const sendBtn = document.getElementById('sendCodeBtn');
			sendBtn.disabled = true;
			sendBtn.textContent = 'ë°œì†¡ ì¤‘...';
			
			// ì„œë²„ì— ì¸ì¦ë²ˆí˜¸ ìš”ì²­
			fetch('/user/sendVerificationCode', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: 'email=' + encodeURIComponent(email)
			})
			.then(response => response.json())
			.then(data => {
				if(data.result === 1) {
					// ì„±ê³µ
					document.getElementById('emailSuccess').style.display = 'block';
					document.getElementById('emailError').style.display = 'none';
					document.getElementById('verificationRow').style.display = 'flex';
					document.getElementById('email').readOnly = true;
					
					sendBtn.textContent = 'ì¬ë°œì†¡';
					sendBtn.disabled = false;
					
					// íƒ€ì´ë¨¸ ì‹œì‘ (5ë¶„)
					startTimer(300);
					
					alert(data.message);
				} else if(data.result === -1) {
					// ì´ë©”ì¼ ì¤‘ë³µ
					alert(data.message);
					sendBtn.disabled = false;
					sendBtn.textContent = 'ì¸ì¦ë²ˆí˜¸ ë°›ê¸°';
				} else {
					// ì‹¤íŒ¨
					alert(data.message);
					sendBtn.disabled = false;
					sendBtn.textContent = 'ì¸ì¦ë²ˆí˜¸ ë°›ê¸°';
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				sendBtn.disabled = false;
				sendBtn.textContent = 'ì¸ì¦ë²ˆí˜¸ ë°›ê¸°';
			});
		}
		
		// ì¸ì¦ë²ˆí˜¸ í™•ì¸
		function verifyCode() {
			const email = document.getElementById('email').value.trim();
			const code = document.getElementById('verificationCode').value.trim();
			
			if(!code || code.length !== 6) {
				alert('6ìë¦¬ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
				return;
			}
			
			fetch('/user/verifySignupCode', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: 'email=' + encodeURIComponent(email) + '&code=' + encodeURIComponent(code)
			})
			.then(response => response.json())
			.then(data => {
				if(data.result === 1) {
					// ì¸ì¦ ì„±ê³µ
					document.getElementById('verifySuccess').style.display = 'block';
					document.getElementById('verifyError').style.display = 'none';
					document.getElementById('verificationCode').readOnly = true;
					isEmailVerified = true;
					
					// íƒ€ì´ë¨¸ ì¤‘ì§€ ë° ìˆ¨ê¹€
					if(timerInterval) {
						clearInterval(timerInterval);
					}
					document.getElementById('timerText').style.display = 'none';
					
					alert(data.message);
				} else {
					// ì¸ì¦ ì‹¤íŒ¨
					document.getElementById('verifyError').style.display = 'block';
					document.getElementById('verifyError').textContent = data.message;
					alert(data.message);
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('ì¸ì¦ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			});
		}
		
		// ì „í™”ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬
		function checkPhoneDuplicate() {
			const phoneInput = document.getElementById('tel');
			const phone = phoneInput.value.trim();
			const phoneError = document.getElementById('phoneError');
			const phoneSuccess = document.getElementById('phoneSuccess');
			
			// ì „í™”ë²ˆí˜¸ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì²´í¬ ì•ˆí•¨ (ì„ íƒ í•­ëª©ì´ë¯€ë¡œ)
			if(!phone) {
				phoneError.style.display = 'none';
				phoneSuccess.style.display = 'none';
				isPhoneAvailable = true;
				return;
			}
			
			// ì „í™”ë²ˆí˜¸ í˜•ì‹ ì²´í¬ (01ë¡œ ì‹œì‘í•˜ëŠ” 9~11ìë¦¬ ìˆ«ì)
			const phonePattern = /^01[0-9]{8,9}$/;
			if(!phonePattern.test(phone)) {
				phoneError.textContent = 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (ì˜ˆ: 01012345678)';
				phoneError.style.display = 'block';
				phoneSuccess.style.display = 'none';
				isPhoneAvailable = false;
				return;
			}
			
			// ì„œë²„ì— ì¤‘ë³µ ì²´í¬ ìš”ì²­
			fetch('/user/checkPhone?phone=' + encodeURIComponent(phone))
				.then(response => response.json())
				.then(data => {
					if(data.isExist) {
						// ì „í™”ë²ˆí˜¸ ì¤‘ë³µ
						phoneError.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.';
						phoneError.style.display = 'block';
						phoneSuccess.style.display = 'none';
						isPhoneAvailable = false;
						phoneInput.style.borderColor = '#e74c3c';
					} else {
						// ì‚¬ìš© ê°€ëŠ¥
						phoneError.style.display = 'none';
						phoneSuccess.style.display = 'block';
						isPhoneAvailable = true;
						phoneInput.style.borderColor = '#28a745';
					}
				})
				.catch(error => {
					console.error('Error:', error);
					phoneError.textContent = 'ì „í™”ë²ˆí˜¸ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
					phoneError.style.display = 'block';
					phoneSuccess.style.display = 'none';
					isPhoneAvailable = false;
				});
		}
		
		
		// íƒ€ì´ë¨¸ ì‹œì‘
		function startTimer(seconds) {
			let timeLeft = seconds;
			const timerSpan = document.querySelector('#timerText span');
			
			// ê¸°ì¡´ íƒ€ì´ë¨¸ ì •ì§€
			if(timerInterval) {
				clearInterval(timerInterval);
			}
			
			timerInterval = setInterval(function() {
				const minutes = Math.floor(timeLeft / 60);
				const secs = timeLeft % 60;
				
				timerSpan.textContent = minutes + ':' + (secs < 10 ? '0' : '') + secs;
				
				timeLeft--;
				
				if(timeLeft < 0) {
					clearInterval(timerInterval);
					timerSpan.textContent = 'ë§Œë£Œë¨';
					alert('ì¸ì¦ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ì¦ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ë°›ì•„ì£¼ì„¸ìš”.');
				}
			}, 1000);
		}
		
		// í”„ë¡œí•„ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
		function previewProfileImage(event) {
			const file = event.target.files[0];
			if (file) {
				// íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
				if (file.size > 10 * 1024 * 1024) {
					alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
					event.target.value = '';
					return;
				}
				
				// ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ ì²´í¬
				if (!file.type.startsWith('image/')) {
					alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
					event.target.value = '';
					return;
				}
				
				// ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
				const reader = new FileReader();
				reader.onload = function(e) {
					document.getElementById('profileIcon').style.display = 'none';
					const previewImage = document.getElementById('previewImage');
					previewImage.src = e.target.result;
					previewImage.style.display = 'block';
				}
				reader.readAsDataURL(file);
			}
		}
		
		function execPostcode() {
			new daum.Postcode({
				oncomplete : function(data) {
					var roadAddr = data.roadAddress || '';
					var jibunAddr = data.jibunAddress || '';
					var extraRoad = '';

					if (data.bname && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)) {
						extraRoad += data.bname;
					}
					if (data.buildingName && data.apartment == 'Y') {
						extraRoad += (extraRoad !== '' ? ', '
								+ data.buildingName : data.buildingName);
					}
					if (extraRoad !== '') {
						extraRoad = '(' + extraRoad + ')';
					}

					document.getElementById('postcode').value = data.zonecode;
					document.getElementById('roadAddress').value = roadAddr;
					document.getElementById('jibunAddress').value = jibunAddr;
					document.getElementById('extraAddress').value = extraRoad;

					document.getElementById('detailAddress').focus();

				}
			}).open();
		}

		function openIdCheck() {
			const email = document.getElementById('email').value.trim();
			if (!email) {
				alert('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
				return;
			}
			// ì´ë©”ì¼ í˜•ì‹ ì²´í¬
			const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (!emailPattern.test(email)) {
				alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.');
				return;
			}
			window.open('/user/checkEmail?email=' + encodeURIComponent(email),
					'emailCheck', 'width=450,height=350');
		}

		function togglePwd(id, btn) {
			const el = document.getElementById(id);
			if (el.type === 'password') {
				el.type = 'text';
				btn.textContent = 'ìˆ¨ê¸°ê¸°';
			} else {
				el.type = 'password';
				btn.textContent = 'ë³´ê¸°';
			}
		}

		function updatePwMeter() {
			const v = document.getElementById('pwd').value;
			const bar = document.getElementById('pwBar');
			const tip = document.getElementById('pwTip');
			let score = 0;
			if (v.length >= 8)
				score++;
			if (/[A-Z]/.test(v))
				score++;
			if (/[a-z]/.test(v))
				score++;
			if (/[0-9]/.test(v))
				score++;
			if (/[^A-Za-z0-9]/.test(v))
				score++;

			const pct = Math.min(100, score * 20);
			bar.style.width = pct + '%';
			if (score <= 2) {
				bar.style.background = 'linear-gradient(135deg, #ff9a9e, #fecfef)';
				tip.textContent = 'ì•½í•¨: ëŒ€/ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ì¡°í•©í•´ ë³´ì„¸ìš”.';
			} else if (score === 3) {
				bar.style.background = 'linear-gradient(135deg, #f6d365, #fda085)';
				tip.textContent = 'ë³´í†µ: ì¡°ê¸ˆë§Œ ë” ê°•í•˜ê²Œ!';
			} else {
				bar.style.background = 'linear-gradient(135deg, #a1ffce, #faffd1)';
				tip.textContent = 'ê°•í•¨: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
			}
		}

	// íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
	async function submitJoin() {
		const email = document.getElementById('email');
		const pwd = document.getElementById('pwd');
		const pwd2 = document.getElementById('pwd2');
		const tel = document.getElementById('tel');

		// ì´ë©”ì¼ ì¸ì¦ í™•ì¸
		if(!isEmailVerified) {
			alert('ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
			email.focus();
			return false;
		}

		// ì´ë©”ì¼ í˜•ì‹ ì²´í¬
		const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
		const emailOk = emailPattern.test(email.value);
		document.getElementById('emailError').style.display = emailOk ? 'none' : 'block';

		if (!emailOk) {
			alert('ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.');
			email.focus();
			return false;
		}

		// ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ì²´í¬
		const pwdOk = (pwd.value.length >= 8);
		document.getElementById('pwdError').style.display = pwdOk ? 'none' : 'block';

		if (!pwdOk) {
			alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
			pwd.focus();
			return false;
		}

		// ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬
		const match = (pwd.value === pwd2.value);
		document.getElementById('pwd2Error').style.display = match ? 'none' : 'block';

		if (!match) {
			alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
			pwd2.focus();
			return false;
		}

		// ì „í™”ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ (ì „í™”ë²ˆí˜¸ê°€ ì…ë ¥ëœ ê²½ìš°ë§Œ)
		if(tel.value.trim()) {
			const phone = tel.value.trim();
			const phonePattern = /^01[0-9]{8,9}$/;
			
			// ì „í™”ë²ˆí˜¸ í˜•ì‹ ì²´í¬
			if(!phonePattern.test(phone)) {
				alert('ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\n(ì˜ˆ: 01012345678)');
				tel.value = '';  // ì…ë ¥ê°’ ì§€ìš°ê¸°
				tel.focus();
				return false;
			}
			
			// ì„œë²„ì— ì¤‘ë³µ ì²´í¬ ìš”ì²­ (ë™ê¸°ì‹)
			try {
				const response = await fetch('/user/checkPhone?phone=' + encodeURIComponent(phone));
				const data = await response.json();
				
				if(data.isExist) {
					// ì „í™”ë²ˆí˜¸ ì¤‘ë³µ
					alert('âš ï¸ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.\në‹¤ë¥¸ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
					tel.value = '';  // ì…ë ¥ê°’ ì§€ìš°ê¸°
					tel.style.borderColor = '#e74c3c';
					tel.focus();
					document.getElementById('phoneError').textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.';
					document.getElementById('phoneError').style.display = 'block';
					document.getElementById('phoneSuccess').style.display = 'none';
					return false;
				}
			} catch(error) {
				console.error('Error:', error);
				alert('ì „í™”ë²ˆí˜¸ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
				return false;
			}
		}

		// ëª¨ë“  ê²€ì¦ í†µê³¼
		return true;
	}
	</script>
</body>
</html>
